
(function(){var data_line,decorate_map,decorate_tl,get_coord,listen_to_events,load_dataset,read_memo,__slice=[].slice;data_line=function(x){return x.trim()!=='';};get_coord=function(ll,memo){if(ll in memo){return memo[ll];}else{return ll.split(',');}};read_memo=function(color,memo){if(memo==null){memo={};}
return function(text){var dt,end,id,lat,ll,lls,llspecs,lon,options,others,point,polyline,start,title,_ref,_ref1,_ref2;_ref=text.split('\t'),id=_ref[0],title=_ref[1],dt=_ref[2],llspecs=_ref[3];if(id==='-'){id=null;}
_ref1=dt.split(','),start=_ref1[0],end=_ref1[1];if(end==null){end='2100';}
lls=(function(){var _i,_len,_ref2,_results;_ref2=llspecs.split(' ');_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){ll=_ref2[_i];_results.push(get_coord(ll,memo));}
return _results;})();polyline=(_ref2=(function(){var _i,_len,_ref2,_results;_results=[];for(_i=0,_len=lls.length;_i<_len;_i++){_ref2=lls[_i],lat=_ref2[0],lon=_ref2[1];_results.push({lat:lat,lon:lon});}
return _results;})(),point=_ref2[0],others=2<=_ref2.length?__slice.call(_ref2,1):[],_ref2);options={theme:TimeMapTheme({lineColor:color,lineWeight:3,icon:'img/tiny-donut.png',iconAnchor:[4,4],iconSize:[8,8]})};if(others.length){return{id:id,title:title,start:start,end:end,options:options,polyline:polyline};}else{if(id!=null){memo[id]=[lat,lon];}
return{id:id,title:title,start:start,end:end,options:options,point:point};}};};load_dataset=function(name,ds){return $.get("data/"+name+".txt",function(data){var color,contents,header,title,_ref,_ref1;_ref=data.trim().split('===\n'),header=_ref[0],contents=_ref[1];_ref1=header.trim().split('\n'),title=_ref1[0],color=_ref1[1];ds.opts.title=title;return ds.loadItems(contents.split('\n').filter(data_line),read_memo(color));});};decorate_tl=function(tm){return tm.initTimeline([Timeline.createBandInfo({width:"58%",intervalPixels:50,intervalUnit:Timeline.DateTime.MONTH}),Timeline.createBandInfo({overview:true,width:"42%",intervalPixels:75,intervalUnit:Timeline.DateTime.YEAR})]);};decorate_map=function(tm){var map;map=tm.getNativeMap();return map.setOptions({panControl:true,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:true,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},overviewMapControl:false,mapTypeControl:false,scaleControl:true,scrollwheel:true});};listen_to_events=function(tm){var map;map=tm.getNativeMap();tm.addFilter('map',function(item){return item.opts.type!=='marker'||item.map.getZoom()>10;});return google.maps.event.addListener(map,'zoom_changed',function(){return tm.filter('map');});};$(document).ready(function(){return $.get('data/list.txt',function(data){var ds,name,tm,train_lines,_ref,_results;train_lines=data.trim().split('\n');tm=TimeMap.init({mapId:'map',timelineId:'tl',datasets:(function(){var _i,_len,_results;_results=[];for(_i=0,_len=train_lines.length;_i<_len;_i++){name=train_lines[_i];_results.push({id:name,type:"basic"});}
return _results;})()});decorate_tl(tm);decorate_map(tm);listen_to_events(tm);_ref=tm.datasets;_results=[];for(name in _ref){ds=_ref[name];_results.push(load_dataset(name,ds));}
return _results;});});}).call(this);
